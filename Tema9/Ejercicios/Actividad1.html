<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad Tema 10</title>
</head>

<body>
    <select id="nombreSelect" onchange="selectNombre()">
        <option value="">Seleccione un nombre</option>
    </select>
    <div id="datos"></div>

    <script>
        // Realizar solicitud AJAX
        function funAjax(url, callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    callback(this);
                }
            };
            xhttp.open("GET", url, true);
            xhttp.send();
        }

        // Llenar el select con los nombres
        function listaNombres() {
            funAjax("jsonGET.php", function (xhttp) {
                let nombres = JSON.parse(xhttp.responseText); // JSON de array
                let select = document.getElementById("nombreSelect");

                // Limpiar opciones anteriores
                select.innerHTML = `<option value="">Seleccione un nombre</option>`;

                // Agregar nombres al select
                nombres.forEach(item => {
                    let option = document.createElement("option");
                    option.value = item.id; // ID del usuario
                    option.textContent = item.nombre; // Nombre visible
                    select.appendChild(option);
                });
            });
        }

        // Manejar el cambio de selección
        function selectNombre() {
            var id = document.getElementById("nombreSelect").value;
            if (id) {
                // Obtener datos del usuario seleccionado
                funAjax(`jsonGET.php?id=${id}`, function (xhttp) {
                    let obj = JSON.parse(xhttp.responseText);

                    // Mostrar los datos en la tabla
                    document.getElementById("datos").innerHTML = `
                        <div class="table-responsive"> 
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Id</th>
                                        <td>${obj.id}</td>
                                    </tr>
                                    <tr>
                                        <th>Nombre</th>
                                        <td>${obj.nombre}</td>
                                    </tr>
                                    <tr>
                                        <th>Apellidos</th>
                                        <td>${obj.apellidos}</td>
                                    </tr>
                                    <tr>
                                        <th>Ciudad</th>
                                        <td>${obj.ciudad}</td>
                                    </tr>
                                </thead>
                            </table>
                        </div>`;
                });
            } else {
                // Limpiar la tabla si no hay selección
                document.getElementById("datos").innerHTML = "";
            }
        }

        // Inicializar la lista de nombres al cargar la página
        window.onload = listaNombres;
    </script>
</body>

</html>