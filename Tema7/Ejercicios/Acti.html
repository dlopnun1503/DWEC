<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Online</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Título y logo -->
        <header>
            <h1 class="text-center my-4">Mi Tienda Online</h1>
        </header>
        
        <!-- Sección de productos disponibles -->
        <section id="contProductos" class="row"></section>

        <!-- Sección de la cesta de compras -->
        <h2 class="my-4">Cesta</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Subtotal</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody id="cesta"></tbody>
            <tfoot>
                <tr>
                    <td colspan="3">Total + IVA</td>
                    <td id="total"></td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
        // Clase Producto
        class Producto {
            constructor(id, nombre, precio, imagen) {
                this.id = id;
                this.nombre = nombre;
                this.precio = precio;
                this.imagen = imagen;
            }
        }

        // Clase ContProductos para renderizar productos
        class ContProductos {
            constructor() {
                this.productos = [
                    new Producto(1, "Bolso", 25.00, "https://via.placeholder.com/100"),
                    new Producto(2, "Móvil", 299.99, "https://via.placeholder.com/100"),
                    new Producto(3, "Taza", 12.99, "https://via.placeholder.com/100"),
                ];
            }

            renderizarProductos() {
                const contenedor = document.getElementById("contProductos");
                this.productos.forEach(producto => {
                    const card = document.createElement("div");
                    card.classList.add("col-md-4", "mb-3");

                    card.innerHTML = `
                        <div class="card">
                            <img src="${producto.imagen}" class="card-img-top" alt="${producto.nombre}">
                            <div class="card-body">
                                <h5 class="card-title">${producto.nombre}</h5>
                                <p class="card-text">${producto.precio.toFixed(2)} €</p>
                                <button class="btn btn-primary" data-id="${producto.id}">Añadir</button>
                            </div>
                        </div>
                    `;
                    contenedor.appendChild(card);
                });
            }
        }

        // Clase Cesta para gestionar la cesta de compras
        class Cesta {
            constructor() {
                this.productos = [];
                this.total = 0;
            }

            añadirProducto(id) {
                const productoExistente = this.productos.find(prod => prod.id === id);
                if (productoExistente) {
                    productoExistente.cantidad++;
                } else {
                    this.productos.push({ id: id, cantidad: 1 });
                }
                this.renderizarCesta();
            }

            eliminarProducto(id) {
                this.productos = this.productos.filter(prod => prod.id !== id);
                this.renderizarCesta();
            }

            calcularTotal() {
                const contProductos = new ContProductos();
                let total = 0;
                this.productos.forEach(item => {
                    const producto = contProductos.productos.find(prod => prod.id === item.id);
                    total += producto.precio * item.cantidad;
                });
                return total * 1.21; // Total con IVA (21%)
            }

            renderizarCesta() {
                const contProductos = new ContProductos();
                const tbody = document.getElementById("cesta");
                tbody.innerHTML = "";
                this.productos.forEach(item => {
                    const producto = contProductos.productos.find(prod => prod.id === item.id);
                    const row = document.createElement("tr");

                    row.innerHTML = `
                        <td>${producto.nombre}</td>
                        <td>${item.cantidad}</td>
                        <td>${producto.precio.toFixed(2)} €</td>
                        <td>${(producto.precio * item.cantidad).toFixed(2)} €</td>
                        <td><button class="btn btn-danger btn-sm" data-id="${producto.id}">Eliminar</button></td>
                    `;
                    tbody.appendChild(row);
                });
                document.getElementById("total").innerText = `${this.calcularTotal().toFixed(2)} €`;
            }
        }

        // Inicialización
        const contProductos = new ContProductos();
        const cesta = new Cesta();

        // Renderizar productos disponibles
        contProductos.renderizarProductos();

        // Event listeners
        document.getElementById("contProductos").addEventListener("click", (event) => {
            if (event.target.tagName === "BUTTON") {
                const id = parseInt(event.target.getAttribute("data-id"));
                cesta.añadirProducto(id);
            }
        });

        document.getElementById("cesta").addEventListener("click", (event) => {
            if (event.target.tagName === "BUTTON") {
                const id = parseInt(event.target.getAttribute("data-id"));
                cesta.eliminarProducto(id);
            }
        });
    </script>
</body>
</html>
