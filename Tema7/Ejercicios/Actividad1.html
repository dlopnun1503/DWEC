<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Actividad Tema 6</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script>

        class Producto {
            #id;
            #nombre;
            #precio;
            #imagen;
            constructor(id, nombre, precio, imagen) {
                this.#id = id;
                this.#nombre = nombre;
                this.#precio = precio;
                this.#imagen = imagen;
            }

            getId() { return this.#id; }
            getNombre() { return this.#nombre; }
            getPrecio() { return this.#precio; }
            getImagen() { return this.#imagen; }
        }

        class contProductos {
            #productos = [];
            #cesta

            constructor(productos) {
                this.#productos = productos;
                this.#cesta = new Cesta(this.#productos);
            }

            getProductos() { return this.#productos; }

            renderizarProductos() {
                var contProductos = document.getElementById("contProductos");

                this.#productos.forEach(producto => {
                    /*
                    Crear el div de la columna
                    Le añadimos los atributos
                    Hacemos lo mismo con los demas
                    */
                    var div = document.createElement("div");
                    div.setAttribute("class", "col-md-4 mb-3");

                    // Crear el contenedor del producto
                    var cardDiv = document.createElement("div");
                    cardDiv.setAttribute("class", "card");

                    // imagen 
                    var img = document.createElement("img");
                    img.setAttribute("src", producto.getImagen());
                    img.setAttribute("class", "card-img-top");
                    img.setAttribute("alt", producto.getNombre());

                    // Crear el cuerpo del producto
                    var cardBody = document.createElement("div");
                    cardBody.setAttribute("class", "card-body");

                    // título
                    var title = document.createElement("h5");
                    title.setAttribute("class", "card-title");
                    title.textContent = producto.getNombre();

                    // precio 
                    var price = document.createElement("p");
                    price.setAttribute("class", "card-text");
                    price.textContent = producto.getPrecio().toFixed(2) + "€";

                    // botón de añadir
                    var button = document.createElement("button");
                    button.setAttribute("class", "btn btn-primary");
                    button.setAttribute("data-id", producto.getId());
                    button.textContent = "Añadir";

                    cardBody.appendChild(title);
                    cardBody.appendChild(price);
                    cardBody.appendChild(button);
                    cardDiv.appendChild(img);
                    cardDiv.appendChild(cardBody);
                    div.appendChild(cardDiv);
                    contProductos.appendChild(div);
                });
            }

        }


        class Cesta {
            #productos;
            #total;

            constructor() {
                this.#productos = [];
                this.#total = 0;
            }

            getProductos() { return this.#productos; }
            getTotal() { return this.#total; }

            anadirProducto(id) {
                let productoExiste = false;

                for (let i = 0; i < this.#productos.length; i++) {
                    if (this.#productos[i].id == id) {
                        this.#productos[i].cantidad++;
                        productoExiste = true;
                    }
                }

                if (!productoExiste) {
                    this.#productos.push({ id, cantidad: 1 });
                }

                this.calcularTotal();
                this.renderizarCesta();
            }


            eliminarProducto(id) {
                for (let i = 0; i < this.#productos.length; i++) {
                    if (this.#productos[i].id === id) {
                        if (this.#productos[i].cantidad > 1) {
                            this.#productos[i].cantidad--;
                        } else {
                            this.#productos.splice(i, 1);
                        }
                    }
                }

                this.calcularTotal();
                this.renderizarCesta();
            }


            calcularTotal() {
                var totalProductos = contProductos.getProductos();
                this.#total = 0;

                for (let i = 0; i < this.#productos.length; i++) {
                    var producto = totalProductos.find(p => p.getId() === this.#productos[i].id);
                    if (producto) {
                        this.#total += producto.getPrecio() * this.#productos[i].cantidad;
                    }
                }
            }



            renderizarCesta() {
                var cesta = document.getElementById("cesta");
                var total = document.getElementById("total");
                var totalProductos = contProductos.getProductos();


                for (var i = 0; i < this.#productos.length; i++) {
                    var item = this.#productos[i];
                    var producto = null;

                    for (var j = 0; j < totalProductos.length; j++) {
                        if (totalProductos[j].getId() === item.id) {
                            producto = totalProductos[j];
                        }
                    }

                    if (producto) {
                        var columna = document.createElement("tr");

                        // Nombre
                        var nombre = document.createElement("td");
                        nombre.textContent = producto.getNombre();
                        columna.appendChild(nombre);

                        // Cantidad
                        var cant = document.createElement("td");
                        cant.textContent = item.cantidad;
                        columna.appendChild(cant);

                        // Precio 
                        var precio = document.createElement("td");
                        precio.textContent = producto.getPrecio().toFixed(2) + "€";
                        columna.appendChild(precio);

                        // Subtotal
                        var subtotal = document.createElement("td");
                        subtotal.textContent = (producto.getPrecio() * item.cantidad).toFixed(2) + "€";
                        columna.appendChild(subtotal);

                        // Botón eliminar
                        var eliminar = document.createElement("td");
                        var botonEliminar = document.createElement("button");
                        botonEliminar.setAttribute("class", "btn btn-danger btn-sm");
                        botonEliminar.textContent = "X";
                        botonEliminar.addEventListener("click", (function (id) {
                            return () => this.eliminarProducto(id);
                        }).call(this, item.id));
                        eliminar.appendChild(botonEliminar);
                        columna.appendChild(eliminar);

                        cesta.appendChild(columna);
                    }
                }

                
                total.textContent = (this.#total * 1.21).toFixed(2) + "€"; 
            }

        }

        var productos = [
            [1, "Bolso", 20, "https://www.bimbaylola.com/dw/image/v2/BDXG_PRD/on/demandware.static/-/Sites-byl-master-catalog/default/dw0e3c3c42/images/24/1/B/241BBBJ3R_10200_ML_1.jpg?sw=800"],
            [2, "Movil", 120, "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYlWZV67m_6ngDkLg6SjTWjan8gcolumnam96eIw&s"],
            [3, "Taza", 10, "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTfDKzTPJvrYn3oncfo4RkSIJXoPJ-i9Yw8jw&s"],
            [4, "Zapatos", 50, "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQULme8iJDtddL1nhsV7Tn1Tv0ZQg5arV-Gwg&s"],
            [5, "Vestido", 30, "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ6hhOyDZjwvrRETBjtvGzOusYC7bynLLO6GQ&s"],
            [6, "Cámara", 100, "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSyCn820_AvwGYw_wH40AkUhN-LxyaJMyL5BA&s"]
        ]

        


        window.onload = function () {
            new contProductos();
        };

    </script>
</head>

<body>
    <div class="container">

        <header>
            <h1><i class="bi bi-shop"></i>De Todo</h1>
            <h4>Ejemplo cálculo de cesta o carrito de la compra...</h4>
        </header>

        <!-- Sección de productos disponibles -->
        <div id="contProductos" class="columna"></div>

        <!-- Sección de la cesta de compras -->
        <h2>Cesta</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Subtotal</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody id="cesta"></tbody>
            <tfoot>
                <tr>
                    <td colspan="3">Total + IVA (21%)</td>
                    <td id="total"></td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>